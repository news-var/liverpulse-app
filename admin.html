<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–õ—ñ–≤–µ—Ä–ø—É–ª—å—Å ‚Äì –ê–¥–º—ñ–Ω</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen flex flex-col">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="bg-red-600 text-white px-4 py-3 shadow-md">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-lg font-bold">–õ—ñ–≤–µ—Ä–ø—É–ª—å—Å ¬∑ –ê–¥–º—ñ–Ω</h1>
                    <p class="text-xs opacity-80">–º–æ–±—ñ–ª—å–Ω–∞ –ø–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è</p>
                </div>
                <div class="text-2xl">‚öôÔ∏è</div>
            </div>
        </header>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="flex-1 px-4 py-4 pb-20">
            <div class="w-full max-w-xl mx-auto bg-white rounded-xl shadow-md p-4 sm:p-6 space-y-6">

                <!-- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -->
                <section class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold mb-1">API URL</label>
                        <input id="apiUrl" type="text"
                               value="https://liverpulse-worker.liverpulse.workers.dev"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-1">Admin Secret</label>
                        <input id="adminKey" type="password" placeholder="–í–∞—à ADMIN_SECRET"
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                </section>

                <hr class="border-gray-200">

                <!-- Broadcast -->
                <section class="space-y-3">
                    <h2 class="text-lg font-bold flex items-center gap-2">
                        <span>üì£ Broadcast (–≤—Å—ñ–º)</span>
                    </h2>
                    <textarea id="broadcastMsg" rows="3"
                              placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –≤—Å—ñ—Ö..."
                              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>
                    <button onclick="sendBroadcast()"
                            class="w-full bg-red-600 text-white text-sm sm:text-base px-4 py-3 rounded-lg font-semibold active:scale-95 transition hover:bg-red-700">
                        –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤—Å—ñ–º
                    </button>
                </section>

                <hr class="border-gray-200">

                <!-- –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É -->
                <section class="space-y-3">
                    <div>
                        <h2 class="text-lg font-bold flex items-center gap-2">
                            <span>üë§ –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É</span>
                        </h2>
                        <p class="text-xs text-gray-500 mt-1">
                            –ú–æ–∂–Ω–∞ –≤–∫–∞–∑–∞—Ç–∏ <span class="font-semibold">Telegram User ID</span> –∞–±–æ <span class="font-semibold">@username</span>.
                        </p>
                    </div>

                    <input id="userId" type="text" placeholder="User ID –∞–±–æ @username"
                           class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-red-500">

                    <textarea id="userMsg" rows="3" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."
                              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>

                    <button onclick="sendToUser()"
                            class="w-full bg-blue-600 text-white text-sm sm:text-base px-4 py-3 rounded-lg font-semibold active:scale-95 transition hover:bg-blue-700">
                        –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
                    </button>
                </section>

                <hr class="border-gray-200">

                <!-- –°–ª—É–∂–±–æ–≤—ñ –¥—ñ—ó -->
                <section class="space-y-3">
                    <h2 class="text-lg font-bold flex items-center gap-2">
                        <span>‚öô –°–ª—É–∂–±–æ–≤—ñ –¥—ñ—ó</span>
                    </h2>

                    <div class="flex flex-col gap-2">
                        <button onclick="forceUpdate('auto')"
                                class="w-full bg-green-600 text-white text-sm sm:text-base px-4 py-3 rounded-lg font-semibold active:scale-95 transition hover:bg-green-700">
                            üìä –§–æ—Ä—Å-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ç—É—Ä–Ω—ñ—Ä—ñ–≤
                        </button>

                        <button onclick="forceUpdate('extra')"
                                class="w-full bg-teal-600 text-white text-sm sm:text-base px-4 py-3 rounded-lg font-semibold active:scale-95 transition hover:bg-teal-700">
                            üèÜ –§–æ—Ä—Å-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö —Ç—É—Ä–Ω—ñ—Ä—ñ–≤
                        </button>

                        <button onclick="sendReminderToSelf()"
                                class="w-full bg-indigo-600 text-white text-sm sm:text-base px-4 py-3 rounded-lg font-semibold active:scale-95 transition hover:bg-indigo-700">
                            ‚è∞ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –º–µ–Ω—ñ
                        </button>

                        <button onclick="resetRating()"
                                class="w-full bg-orange-600 text-white text-sm sm:text-base px-4 py-3 rounded-lg font-semibold active:scale-95 transition hover:bg-orange-700">
                            ‚ôªÔ∏è –°–∫–∏–Ω—É—Ç–∏ —Ä–µ–π—Ç–∏–Ω–≥ —É—Å—ñ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º
                        </button>
                    </div>
                </section>

                <div id="result" class="mt-2 p-3 rounded hidden text-sm"></div>
            </div>
        </main>
    </div>

    <script>
        async function sendBroadcast() {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const adminKey = document.getElementById('adminKey').value.trim();
            const message = document.getElementById('broadcastMsg').value.trim();

            if (!message) {
                showResult('–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è!', 'error');
                return;
            }

            try {
                const response = await fetch(`${apiUrl}/api/admin/broadcast`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Key': adminKey
                    },
                    body: JSON.stringify({ message })
                });

                const data = await response.json();

                if (response.ok) {
                    showResult(`‚úÖ –ù–∞–¥—ñ—Å–ª–∞–Ω–æ ${data.sent} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º!`, 'success');
                    document.getElementById('broadcastMsg').value = '';
                } else {
                    showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        }

        async function sendToUser() {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const adminKey = document.getElementById('adminKey').value.trim();
            const target = document.getElementById('userId').value.trim();
            const message = document.getElementById('userMsg').value.trim();

            if (!target || !message) {
                showResult('–í–≤–µ–¥—ñ—Ç—å User ID –∞–±–æ @username —ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è!', 'error');
                return;
            }

            try {
                const response = await fetch(`${apiUrl}/api/admin/send-user`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Key': adminKey
                    },
                    body: JSON.stringify({ target, message })
                });

                const data = await response.json();

                if (response.ok) {
                    showResult(`‚úÖ –ù–∞–¥—ñ—Å–ª–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É ${target}!`, 'success');
                    document.getElementById('userMsg').value = '';
                } else {
                    showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        }

        async function forceUpdate(mode) {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const adminKey = document.getElementById('adminKey').value.trim();

            try {
                const response = await fetch(`${apiUrl}/api/force-update?mode=${mode}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Key': adminKey
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    showResult(`‚úÖ –§–æ—Ä—Å-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è (${mode}) –≤–∏–∫–æ–Ω–∞–Ω–æ`, 'success');
                } else {
                    showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${data.error || 'unknown'}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        }

        async function sendReminderToSelf() {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const adminKey = document.getElementById('adminKey').value.trim();
            const userField = document.getElementById('userId').value.trim();

            try {
                const params = userField ? `?userId=${encodeURIComponent(userField)}` : '';
                const response = await fetch(`${apiUrl}/api/notify-upcoming${params}`, {
                    method: 'POST',
                    headers: { 'X-Admin-Key': adminKey }
                });

                const data = await response.json();

                if (response.ok && data.ok) {
                    showResult('‚úÖ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç—ñ–ª—å–∫–∏ –≤–∞–º', 'success');
                } else {
                    showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${data.message || data.error || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        }

        async function resetRating() {
            const apiUrl = document.getElementById('apiUrl').value.trim();
            const adminKey = document.getElementById('adminKey').value.trim();

            if (!confirm('–¢–æ—á–Ω–æ —Å–∫–∏–Ω—É—Ç–∏ —Ä–µ–π—Ç–∏–Ω–≥ —É—Å—ñ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º?')) return;

            try {
                const response = await fetch(`${apiUrl}/api/reset-rating`, {
                    method: 'POST',
                    headers: { 'X-Admin-Key': adminKey }
                });

                const data = await response.json();

                if (response.ok) {
                    showResult(`‚úÖ –†–µ–π—Ç–∏–Ω–≥ —Å–∫–∏–Ω—É—Ç–æ ${data.users} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º`, 'success');
                } else {
                    showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        }

        function showResult(msg, type) {
            const result = document.getElementById('result');
            result.textContent = msg;
            result.className =
                'mt-2 p-3 rounded text-sm ' +
                (type === 'success'
                    ? 'bg-green-100 text-green-800'
                    : 'bg-red-100 text-red-800');
            result.classList.remove('hidden');
        }
    </script>
</body>
</html>
